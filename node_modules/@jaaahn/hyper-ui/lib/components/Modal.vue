<template>
    <teleport to="#hyper-modals-container">
        <div class="hyper-modal" ref="modal" @click="close()" :class="{ open: modelValue }">
            <div id="visual" @click.stop="" :style="'background:' + background">
                <div id="header">
                    <hy-button @click="close()" type="transparent">
                        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1000 1000">
                            <path d="M150.062+74.4688C130.868+74.4544+111.656+81.7726+97+96.4062C67.6887+125.674+67.6701+173.158+96.9375+202.469L394.031+500L96.9375+797.531C67.6701+826.843+67.6887+874.326+97+903.594C126.311+932.861+173.795+932.843+203.062+903.531L500+606.156L796.938+903.531C826.205+932.843+873.689+932.862+903+903.594C932.311+874.326+932.33+826.842+903.062+797.531L605.969+500L903.062+202.469C932.33+173.157+932.311+125.674+903+96.4062C888.344+81.7726+869.132+74.4544+849.938+74.4688C830.743+74.4831+811.571+81.8131+796.938+96.4688L500+393.844L203.062+96.4688C248.429+81.8131+169.257+74.4831+150.062+74.4688Z" />
                        </svg>
                    </hy-button>
                </div>

                <div id="content" ref="content" :class="{ hideScrollbars }">
                    <slot />
                </div>
            </div>
        </div>
    </teleport>
</template>

<script>
import Button from "./Button.vue";
import { disableBodyScroll, enableBodyScroll } from "body-scroll-lock";

export default {
    name: "HyModal",
    props: {
        modelValue: {
            type: Boolean,
            required: true,
        },
        zIndex: {
            type: Number,
            default: 100,
        },
        background: {
            type: String,
            default: null,
        },
        hideScrollbars: {
            type: Boolean,
            default: true,
        },
    },
    watch: {
        async modelValue(val) {
            if (val == true) {
                this.$refs.modal.style.opacity = 1;
                this.$refs.content.scrollTop = 0;
                disableBodyScroll(this.$refs.content);
            } else {
                await new Promise((resolve) => setTimeout(() => resolve(), 200));
                this.$refs.modal.style.opacity = 0;
                enableBodyScroll(this.$refs.content);
            }
        },
        zIndex() {
            this.$refs.cover.styles.zIndex = this.zIndex;
        },
        background() {
            if (!this.background) return;
            this.$refs.cover.styles.background = this.background;
        },
    },
    methods: {
        close() {
            this.$emit("update:modelValue", false);
        },
    },
    components: {
        Button,
    },
};
</script>

<style lang="scss">
.hyper-modal {
    height: 100vh;
    width: 100vw;
    position: fixed;
    left: 0;
    top: 0;
    z-index: 200;
    pointer-events: none;
    opacity: 0;

    &,
    #visual {
        transition-duration: 0.2s;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-property: background, transform;
    }

    &.open {
        pointer-events: initial;
        background: var(--modal-cover-color);
        cursor: zoom-out;

        #visual {
            transform: translateY(0%);
        }
    }

    #visual {
        cursor: default;
        padding: 20px;
        border-radius: 20px 20px 0 0;
        background-color: var(--modal-bg-color);
        position: fixed;
        bottom: 0;
        width: 100%;
        max-height: 90vh;
        transform: translateY(100%);
        overflow: hidden;

        #header {
            display: flex;
            justify-content: flex-end;

            .hyper-button {
                margin: 0;

                button {
                    background-color: red;
                    padding: 10px;
                    border-radius: 1000px;
                    background-color: var(--color-gray-3);
                    width: 52px;
                    height: 52px;
                    display: grid;
                    place-items: center;

                    &:hover {
                        background-color: var(--button-light-blue-hover);
                    }

                    svg {
                        height: 22px;
                        width: 22px;
                        fill: var(--font-color-dark);
                    }
                }
            }
        }

        #content {
            margin: 10px 0 0 0;
            overflow: scroll;
            max-height: calc(90vh - 110px - env(safe-area-inset-bottom));
            padding-bottom: 20px;
        }
    }
}

@media only screen and (min-width: 800px) {
    .hyper-modal {
        &.open #visual {
            transform: translate(-50%, 50%);
            bottom: 50%;
            opacity: 1;
            box-shadow: 0px 0px 70px 20px var(--modal-shadow-color);
        }

        #visual {
            border-radius: 20px;
            left: 50%;
            bottom: 30%;
            width: min(80%, 600px);
            opacity: 0;
            transform: translate(-50%, 100%);
            transition-duration: 0.3s;
            transition-property: background, transform, bottom, opacity;

            #content {
                max-height: calc(90vh - 110px - env(safe-area-inset-bottom));
                padding-bottom: 0px;

                :last-child {
                    margin-bottom: 0;
                }
            }
        }
    }
}

@media only screen and (max-width: 799px) {
    .hyper-modal #visual {
        min-height: 40vh;
    }
}
</style>
