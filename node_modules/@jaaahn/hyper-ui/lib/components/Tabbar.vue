<template>
    <div class="hyper-tabbar" :class="{ disabled }" ref="tabbar">
        <slot />
    </div>
</template>

<script>
export default {
    name: "HyTabbar",
    data() {
        return {};
    },
    props: {
        modelValue: {
            type: String,
            required: true,
        },
        disabled: {
            type: Boolean,
            default: false,
        },
    },
    watch: {
        modelValue() {
            this.updateClassLists();
        },
    },
    methods: {
        updateValue(event) {
            let value = event.target.dataset.value;
            this.$emit("update:modelValue", value);
        },
        updateClassLists() {
            let options = Array.from(this.$refs.tabbar.children);

            options.forEach((el) => {
                if (el.dataset.value == this.modelValue) {
                    return el.classList.add("selected");
                }

                el.classList.remove("selected");
            });
        },
        addClickListeners() {
            let options = Array.from(this.$refs.tabbar.children);

            options.forEach((el) => {
                el.addEventListener("click", (event) => {
                    this.updateValue(event);
                });
            });
        },
    },
    mounted() {
        this.addClickListeners();
        this.updateClassLists();
    },
};
</script>

<style lang="scss">
.hyper-tabbar {
    margin: var(--element-margin);
    position: relative;
    min-width: max-content;
    padding: 3px;
    border: var(--element-border-secondary);
    border-radius: var(--element-border-radius);
    background-color: var(--element-secondary-bg-color);
    transition: var(--element-transition);
    transition-property: filter;
    box-shadow: var(--element-shadow);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--flex-gap);

    &.disabled {
        cursor: not-allowed;
        filter: opacity(50%);

        p[data-value] {
            pointer-events: none;
        }
    }

    // In order to increase css specificity over the ones in globals.scss
    p[data-value] {
        border: none;
        margin: 0;
        flex: 1;
        text-align: center;
        padding: calc(var(--element-padding) - 3px);
        border-radius: calc(var(--element-border-radius) * 0.6);
        cursor: pointer;
        transition: var(--element-transition);
        transition-property: background-color, color;

        &.selected {
            background-color: var(--element-primary-bg-color);
            color: var(--font-color-bright);
        }

        &:not([disabled]) {
            &:not(.selected) {
                &:hover {
                    background-color: var(--element-secondary-hover-bg-color);
                }
            }
        }
    }
}
</style>
